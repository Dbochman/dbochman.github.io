{"version":3,"file":"BlogTrafficChart-O8HGRTbv.js","sources":["../../src/components/analytics/charts/BlogTrafficChart.tsx"],"sourcesContent":["import { AreaChart, Area, XAxis, YAxis, Tooltip, ResponsiveContainer, TooltipProps, Legend } from 'recharts';\nimport { NameType, ValueType } from 'recharts/types/component/DefaultTooltipContent';\nimport type { GA4HistoryEntry } from '../types';\n\nconst COLORS = [\n  'hsl(var(--chart-1))',\n  'hsl(var(--chart-2))',\n  'hsl(var(--chart-3))',\n  'hsl(var(--chart-4))',\n  'hsl(var(--chart-5, var(--primary)))',\n  'hsl(var(--muted-foreground))',\n];\n\nfunction CustomTooltip({ active, payload, label }: TooltipProps<ValueType, NameType>) {\n  if (!active || !payload || !payload.length) return null;\n  return (\n    <div className=\"bg-popover text-popover-foreground border border-border rounded-lg px-3 py-2 text-sm shadow-md max-w-xs\">\n      <p className=\"font-medium mb-1\">{label}</p>\n      {payload.filter(e => Number(e.value) > 0).map((entry, i) => (\n        <p key={i} className=\"truncate\">\n          <span className=\"inline-block w-2 h-2 rounded-full mr-1.5\" style={{ backgroundColor: entry.color }} />\n          {entry.name}: {Number(entry.value).toLocaleString()}\n        </p>\n      ))}\n    </div>\n  );\n}\n\ninterface PostLookups {\n  bySlug: Map<string, { title: string; slug: string }>;\n  byStrippedSlug: Map<string, { title: string; slug: string }>;\n  byTitleKey: Map<string, { title: string; slug: string }>;\n}\n\ninterface BlogTrafficChartProps {\n  data: GA4HistoryEntry[];\n  postLookups: PostLookups;\n  matchPost: (slug: string, lookups: PostLookups) => { title: string; slug: string } | undefined;\n}\n\nexport function BlogTrafficChart({ data, postLookups, matchPost }: BlogTrafficChartProps) {\n  if (data.length === 0) {\n    return (\n      <div className=\"h-64 flex items-center justify-center text-muted-foreground\">\n        No data available\n      </div>\n    );\n  }\n\n  // First pass: accumulate total sessions per canonical slug across all entries\n  const cumulativeBySlug = new Map<string, number>();\n  for (const entry of data) {\n    for (const p of entry.topPages ?? []) {\n      if (!p.page.startsWith('/blog/') || p.page === '/blog/' || p.page === '/blog') continue;\n      const normalized = p.page.replace(/\\/$/, '');\n      const slug = normalized.replace('/blog/', '');\n      const post = matchPost(slug, postLookups);\n      const key = post?.slug ?? slug;\n      cumulativeBySlug.set(key, (cumulativeBySlug.get(key) ?? 0) + p.sessions);\n    }\n  }\n\n  // Pick top 5 by cumulative sessions\n  const top5 = [...cumulativeBySlug.entries()]\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 5)\n    .map(([slug]) => slug);\n\n  const top5Set = new Set(top5);\n\n  // Resolve display names\n  const displayNames = new Map<string, string>();\n  for (const slug of top5) {\n    const post = matchPost(slug, postLookups);\n    const title = post?.title ?? slug;\n    // Truncate long titles for legend\n    displayNames.set(slug, title.length > 30 ? title.slice(0, 28) + 'â€¦' : title);\n  }\n\n  // Build chart data: one row per history entry\n  const chartData = data.map((entry) => {\n    const merged = new Map<string, number>();\n    for (const p of entry.topPages ?? []) {\n      if (!p.page.startsWith('/blog/') || p.page === '/blog/' || p.page === '/blog') continue;\n      const normalized = p.page.replace(/\\/$/, '');\n      const slug = normalized.replace('/blog/', '');\n      const post = matchPost(slug, postLookups);\n      const key = post?.slug ?? slug;\n      merged.set(key, (merged.get(key) ?? 0) + p.sessions);\n    }\n\n    const row: Record<string, string | number> = {\n      date: new Date(entry.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),\n    };\n\n    let otherSessions = 0;\n    for (const [slug, sessions] of merged) {\n      if (top5Set.has(slug)) {\n        row[slug] = sessions;\n      } else {\n        otherSessions += sessions;\n      }\n    }\n    // Ensure all top5 keys exist\n    for (const slug of top5) {\n      if (!(slug in row)) row[slug] = 0;\n    }\n    row['Other'] = otherSessions;\n\n    return row;\n  });\n\n  const tickInterval = Math.max(0, Math.ceil(chartData.length / 6) - 1);\n\n  const allKeys = [...top5, 'Other'];\n\n  return (\n    <div className=\"h-72 w-full\">\n      <ResponsiveContainer width=\"100%\" height={288}>\n        <AreaChart data={chartData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\n          <defs>\n            {allKeys.map((key, i) => (\n              <linearGradient key={key} id={`blogGrad-${i}`} x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                <stop offset=\"5%\" stopColor={COLORS[i % COLORS.length]} stopOpacity={0.3} />\n                <stop offset=\"95%\" stopColor={COLORS[i % COLORS.length]} stopOpacity={0} />\n              </linearGradient>\n            ))}\n          </defs>\n          <XAxis\n            dataKey=\"date\"\n            tick={{ fontSize: 12 }}\n            tickLine={false}\n            axisLine={false}\n            interval={tickInterval}\n            className=\"text-muted-foreground\"\n          />\n          <YAxis\n            tick={{ fontSize: 12 }}\n            tickLine={false}\n            axisLine={false}\n            tickFormatter={(value) => value.toLocaleString()}\n            className=\"text-muted-foreground\"\n          />\n          <Tooltip content={<CustomTooltip />} />\n          <Legend\n            verticalAlign=\"bottom\"\n            height={36}\n            formatter={(value: string) => {\n              if (value === 'Other') return 'Other';\n              return displayNames.get(value) ?? value;\n            }}\n            wrapperStyle={{ fontSize: '11px' }}\n          />\n          {allKeys.map((key, i) => (\n            <Area\n              key={key}\n              type=\"monotone\"\n              dataKey={key}\n              name={key}\n              stackId=\"1\"\n              stroke={COLORS[i % COLORS.length]}\n              fill={`url(#blogGrad-${i})`}\n              strokeWidth={1.5}\n            />\n          ))}\n        </AreaChart>\n      </ResponsiveContainer>\n    </div>\n  );\n}\n"],"names":["COLORS","CustomTooltip","active","payload","label","jsxs","jsx","e","entry","BlogTrafficChart","data","postLookups","matchPost","cumulativeBySlug","p","slug","key","top5","a","b","top5Set","displayNames","title","chartData","merged","row","otherSessions","sessions","tickInterval","allKeys","ResponsiveContainer","AreaChart","i","XAxis","YAxis","value","Tooltip","Legend","Area"],"mappings":"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"}