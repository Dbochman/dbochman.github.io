import{r as n,j as w}from"./vendor-DeyLhXpq.js";import{M as A,o as z,u as S,q as D,r as K,t as U,L as q}from"./index-C80gN8Bw.js";function I(e,r){if(typeof e=="function")return e(r);e!=null&&(e.current=r)}function B(...e){return r=>{let t=!1;const o=e.map(u=>{const f=I(u,r);return!t&&typeof f=="function"&&(t=!0),f});if(t)return()=>{for(let u=0;u<o.length;u++){const f=o[u];typeof f=="function"?f():I(e[u],null)}}}}function F(...e){return n.useCallback(B(...e),e)}class G extends n.Component{getSnapshotBeforeUpdate(r){const t=this.props.childRef.current;if(t&&r.isPresent&&!this.props.isPresent&&this.props.pop!==!1){const o=t.offsetParent,u=z(o)&&o.offsetWidth||0,f=z(o)&&o.offsetHeight||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=u-s.width-s.left,s.bottom=f-s.height-s.top}return null}componentDidUpdate(){}render(){return this.props.children}}function V({children:e,isPresent:r,anchorX:t,anchorY:o,root:u,pop:f}){const s=n.useId(),m=n.useRef(null),g=n.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:R}=n.useContext(A),a=e.props?.ref??e?.ref,M=F(m,a);return n.useInsertionEffect(()=>{const{width:c,height:p,top:d,left:C,right:x,bottom:P}=g.current;if(r||f===!1||!m.current||!c||!p)return;const j=t==="left"?`left: ${C}`:`right: ${x}`,b=o==="bottom"?`bottom: ${P}`:`top: ${d}`;m.current.dataset.motionPopId=s;const l=document.createElement("style");R&&(l.nonce=R);const y=u??document.head;return y.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${c}px !important;
            height: ${p}px !important;
            ${j}px !important;
            ${b}px !important;
          }
        `),()=>{y.contains(l)&&y.removeChild(l)}},[r]),w.jsx(G,{isPresent:r,childRef:m,sizeRef:g,pop:f,children:f===!1?e:n.cloneElement(e,{ref:M})})}const X=({children:e,initial:r,isPresent:t,onExitComplete:o,custom:u,presenceAffectsLayout:f,mode:s,anchorX:m,anchorY:g,root:R})=>{const a=S(Y),M=n.useId();let c=!0,p=n.useMemo(()=>(c=!1,{id:M,initial:r,isPresent:t,custom:u,onExitComplete:d=>{a.set(d,!0);for(const C of a.values())if(!C)return;o&&o()},register:d=>(a.set(d,!1),()=>a.delete(d))}),[t,a,o]);return f&&c&&(p={...p}),n.useMemo(()=>{a.forEach((d,C)=>a.set(C,!1))},[t]),n.useEffect(()=>{!t&&!a.size&&o&&o()},[t]),e=w.jsx(V,{pop:s==="popLayout",isPresent:t,anchorX:m,anchorY:g,root:R,children:e}),w.jsx(D.Provider,{value:p,children:e})};function Y(){return new Map}const $=e=>e.key||"";function H(e){const r=[];return n.Children.forEach(e,t=>{n.isValidElement(t)&&r.push(t)}),r}const N=({children:e,custom:r,initial:t=!0,onExitComplete:o,presenceAffectsLayout:u=!0,mode:f="sync",propagate:s=!1,anchorX:m="left",anchorY:g="top",root:R})=>{const[a,M]=K(s),c=n.useMemo(()=>H(e),[e]),p=s&&!a?[]:c.map($),d=n.useRef(!0),C=n.useRef(c),x=S(()=>new Map),P=n.useRef(new Set),[j,b]=n.useState(c),[l,y]=n.useState(c);U(()=>{d.current=!1,C.current=c;for(let h=0;h<l.length;h++){const i=$(l[h]);p.includes(i)?(x.delete(i),P.current.delete(i)):x.get(i)!==!0&&x.set(i,!1)}},[l,p.length,p.join("-")]);const v=[];if(c!==j){let h=[...c];for(let i=0;i<l.length;i++){const E=l[i],L=$(E);p.includes(L)||(h.splice(i,0,E),v.push(E))}return f==="wait"&&v.length&&(h=v),y(H(h)),b(c),null}const{forceRender:T}=n.useContext(q);return w.jsx(w.Fragment,{children:l.map(h=>{const i=$(h),E=s&&!a?!1:c===l||p.includes(i),L=()=>{if(P.current.has(i))return;if(P.current.add(i),x.has(i))x.set(i,!0);else return;let k=!0;x.forEach(W=>{W||(k=!1)}),k&&(T?.(),y(C.current),s&&M?.(),o&&o())};return w.jsx(X,{isPresent:E,initial:!d.current||t?void 0:!1,custom:r,presenceAffectsLayout:u,mode:f,root:R,onExitComplete:E?void 0:L,anchorX:m,anchorY:g,children:h},i)})})};export{N as A};
