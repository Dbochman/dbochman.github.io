{"version":3,"mappings":"oYAKA,MAAMA,EAAa,+BAGbC,EAAkBC,GAAe,qCAAqC,KAAKA,CAAE,EAQnF,SAAwBC,GAAS,CAC/B,KAAM,CAACC,CAAY,EAAIC,EAAA,EACjB,CAACC,EAAMC,CAAO,EAAIC,WAA2B,IAAI,EACjD,CAACC,EAAOC,CAAQ,EAAIF,WAAwB,IAAI,EAGhDG,EAAUC,UAAQ,IAAM,CAC5B,MAAMC,EAAQT,EAAa,IAAI,OAAO,EACtC,OAAIS,GAASZ,EAAeY,CAAK,EACxBA,EAEF,SACT,EAAG,CAACT,CAAY,CAAC,EAGXU,EAASV,EAAa,IAAI,MAAM,EAqDtC,OAnDAW,YAAU,IAAM,CACdR,EAAQ,IAAI,EACZG,EAAS,IAAI,EAEb,eAAeM,GAAY,CACzB,IAAIC,EAAc,GAElB,GAAI,CACF,MAAMC,EAAS,MAAM,MAAM,GAAGlB,CAAU,UAAUW,CAAO,GAAI,CAC3D,YAAa,UACd,EAED,GAAIO,EAAO,GAAI,CACb,MAAMC,EAAU,MAAMD,EAAO,OAC7BX,EAAQ,CACN,MAAOY,EAAQ,MACf,cAAeA,EAAQ,cACvB,YAAaA,EAAQ,YACtB,EACD,MACF,CAGID,EAAO,SAAW,MACpBD,EAAc,GAElB,MAAQ,CAEN,QAAQ,MAAM,wDAAwD,CACxE,CAGA,GAAI,CACF,MAAMG,EAAS,MAAMC,EAAA,wDAAAC,EAAA,qGAAAA,EAAA,wGAAAA,EAAA,0CAAAC,KAAA,kDAAAD,EAAA,yCAAAC,KAAA,sCAAAZ,CAAA,SACrBJ,EAAQ,CACN,MAAOa,EAAO,MACd,cAAe,KACf,YAAa,GACd,CACH,OAASI,EAAK,CAEVd,EADEO,EACO,gEAEAO,aAAe,MAAQA,EAAI,QAAU,sBAF0B,CAI5E,CACF,CAEAR,EAAA,CACF,EAAG,CAACL,CAAO,CAAC,EAERF,EACKgB,OAAC,OAAI,UAAU,eAAe,mCAAuBhB,CAAA,EAAM,EAG/DH,EAKHoB,MAACC,EAAA,CAEC,aAAcrB,EAAK,MACnB,QAAAK,EACA,cAAeG,GAAU,OACzB,qBAAsBR,EAAK,eAJtBK,CAAA,EALAe,MAAC,OAAI,UAAU,yCAAyC,CAYnE","names":["WORKER_URL","isValidBoardId","id","Kanban","searchParams","useSearchParams","data","setData","useState","error","setError","boardId","useMemo","param","cardId","useEffect","loadBoard","apiNotFound","apiRes","apiData","module","__variableDynamicImportRuntimeHelper","__vitePreload","n","err","jsxs","jsx","KanbanBoard"],"ignoreList":[],"sources":["../../src/components/projects/kanban/index.tsx"],"sourcesContent":["import { useState, useEffect, useMemo } from 'react';\nimport { useSearchParams } from 'react-router-dom';\nimport { KanbanBoard } from './KanbanBoard';\nimport type { KanbanBoard as BoardType } from '@/types/kanban';\n\nconst WORKER_URL = 'https://api.dylanbochman.com';\n\n// Board ID validation (matches worker SAFE_ID regex)\nconst isValidBoardId = (id: string) => /^[a-z0-9][a-z0-9-]{0,48}[a-z0-9]?$/.test(id);\n\ninterface BoardData {\n  board: BoardType;\n  headCommitSha: string | null;\n  precompiled?: boolean;\n}\n\nexport default function Kanban() {\n  const [searchParams] = useSearchParams();\n  const [data, setData] = useState<BoardData | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  // Get board ID from URL, default to 'roadmap'\n  const boardId = useMemo(() => {\n    const param = searchParams.get('board');\n    if (param && isValidBoardId(param)) {\n      return param;\n    }\n    return 'roadmap';\n  }, [searchParams]);\n\n  // Get card ID from URL for deep linking\n  const cardId = searchParams.get('card');\n\n  useEffect(() => {\n    setData(null);\n    setError(null);\n\n    async function loadBoard() {\n      let apiNotFound = false;\n      // Try to load from worker API first (has commit SHA for conflict detection)\n      try {\n        const apiRes = await fetch(`${WORKER_URL}/board/${boardId}`, {\n          credentials: 'include',\n        });\n\n        if (apiRes.ok) {\n          const apiData = await apiRes.json();\n          setData({\n            board: apiData.board,\n            headCommitSha: apiData.headCommitSha,\n            precompiled: apiData.precompiled,\n          });\n          return;\n        }\n\n        // Handle 404 - board not found\n        if (apiRes.status === 404) {\n          apiNotFound = true;\n        }\n      } catch {\n        // API unavailable, fall back to precompiled JS\n        console.debug('Worker API unavailable, falling back to precompiled JS');\n      }\n\n      // Fallback: load from precompiled JS (no commit SHA - saves may not work)\n      try {\n        const module = await import(`@/generated/kanban/${boardId}.js`);\n        setData({\n          board: module.board,\n          headCommitSha: null, // No SHA available from static file\n          precompiled: true,\n        });\n      } catch (err) {\n        if (apiNotFound) {\n          setError('Board not found. It may have been deleted or not yet created.');\n        } else {\n          setError(err instanceof Error ? err.message : 'Failed to load board');\n        }\n      }\n    }\n\n    loadBoard();\n  }, [boardId]);\n\n  if (error) {\n    return <div className=\"text-red-500\">Failed to load board: {error}</div>;\n  }\n\n  if (!data) {\n    return <div className=\"animate-pulse h-96 bg-muted rounded-lg\" />;\n  }\n\n  return (\n    <KanbanBoard\n      key={boardId} // Force remount when board changes to reset internal state\n      initialBoard={data.board}\n      boardId={boardId}\n      initialCardId={cardId || undefined}\n      initialHeadCommitSha={data.headCommitSha}\n    />\n  );\n}\n"],"file":"index-DrkJXguo.js"}