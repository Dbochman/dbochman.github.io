{"version":3,"mappings":"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","names":["mermaidInstance","mermaidPromise","lastThemeKey","readHslVar","name","fallback","value","getMermaid","mod","ensureMermaidInitialized","mermaid","themeKey","AnimatedMermaidDiagram","code","nodes","speed","onComplete","onLinkClick","diagramId","useId","containerRef","useRef","svg","setSvg","useState","error","setError","currentIndex","setCurrentIndex","isPlaying","setIsPlaying","awaitingDecision","setAwaitingDecision","useEffect","isActive","renderedSvg","err","svgElement","activeNodeElement","node","nodeIndex","nodeGroup","currentNode","isDecision","timer","prev","nextIndex","nextNode","start","useCallback","atTerminal","pause","reset","skipToNext","targetIndex","targetNode","goBack","continueFromDecision","progress","isComplete","jsxs","cn","jsx","Button","SkipBack","ExternalLink","RotateCcw","Pause","Play","Fragment","SkipForward"],"ignoreList":[],"sources":["../../src/components/projects/incident-command-diagrams/AnimatedMermaidDiagram.tsx"],"sourcesContent":["/**\n * Animated Mermaid Diagram\n * - Renders Mermaid flowchart then animates through nodes\n * - Supports auto-play with configurable speed\n * - Pauses at decision nodes with slow pulse effect\n * - Spotlight effect highlights current node\n */\nimport { useEffect, useId, useState, useCallback, useRef } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Play, Pause, RotateCcw, SkipForward, SkipBack, ExternalLink } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport type { Mermaid } from 'mermaid';\n\nexport interface AnimationNode {\n  id: string;\n  label: string;\n  description: string;\n  type?: 'decision' | 'link';\n  /** Branch options for decision nodes: [label, targetNodeIndex] */\n  branches?: [[string, number], [string, number]];\n  /** Target diagram ID for link nodes (e.g., 'incident-management') */\n  linkTo?: string;\n  /** Terminal nodes end the walkthrough (show replay button) */\n  terminal?: boolean;\n  /** Override the next step index instead of defaulting to currentIndex + 1 */\n  continueAt?: number;\n}\n\n// Lazy-load mermaid\nlet mermaidInstance: Mermaid | null = null;\nlet mermaidPromise: Promise<Mermaid> | null = null;\nlet lastThemeKey = '';\n\nfunction readHslVar(name: string, fallback: string) {\n  if (typeof window === 'undefined') return fallback;\n  const value = getComputedStyle(document.documentElement).getPropertyValue(name).trim();\n  return value ? `hsl(${value})` : fallback;\n}\n\nasync function getMermaid(): Promise<Mermaid> {\n  if (mermaidInstance) return mermaidInstance;\n  if (mermaidPromise) return mermaidPromise;\n\n  mermaidPromise = import('mermaid').then((mod) => {\n    mermaidInstance = mod.default;\n    return mermaidInstance;\n  });\n\n  return mermaidPromise;\n}\n\nasync function ensureMermaidInitialized(): Promise<Mermaid> {\n  const mermaid = await getMermaid();\n\n  const themeKey = [\n    readHslVar('--background', '#0b0f19'),\n    readHslVar('--card', '#111827'),\n    readHslVar('--muted', '#111827'),\n    readHslVar('--foreground', '#f9fafb'),\n    readHslVar('--muted-foreground', '#9ca3af'),\n    readHslVar('--border', '#1f2937'),\n  ].join('|');\n\n  if (lastThemeKey !== themeKey) {\n    mermaid.initialize({\n      startOnLoad: false,\n      // SECURITY: Using 'strict' mode for XSS protection.\n      // Node ID querying (line ~151) uses developer-controlled IDs, not user input.\n      // Diagram code is hardcoded, not user-provided, so strict mode is safe.\n      securityLevel: 'strict',\n      theme: 'base',\n      themeVariables: {\n        background: 'transparent',\n        primaryColor: readHslVar('--muted', '#111827'),\n        primaryTextColor: readHslVar('--foreground', '#f9fafb'),\n        primaryBorderColor: readHslVar('--border', '#1f2937'),\n        secondaryColor: readHslVar('--card', '#111827'),\n        secondaryTextColor: readHslVar('--foreground', '#f9fafb'),\n        tertiaryColor: readHslVar('--background', '#0b0f19'),\n        lineColor: readHslVar('--muted-foreground', '#9ca3af'),\n        edgeLabelBackground: readHslVar('--background', '#0b0f19'),\n        fontFamily: 'inherit',\n      },\n    });\n    lastThemeKey = themeKey;\n  }\n\n  return mermaid;\n}\n\ninterface AnimatedMermaidDiagramProps {\n  code: string;\n  /** Ordered node sequence for animation */\n  nodes: AnimationNode[];\n  /** Animation interval in ms (default: 1500) */\n  speed?: number;\n  /** Callback when animation completes */\n  onComplete?: () => void;\n  /** Callback when a link node is clicked */\n  onLinkClick?: (linkTo: string) => void;\n}\n\nexport function AnimatedMermaidDiagram({\n  code,\n  nodes,\n  speed = 1500,\n  onComplete,\n  onLinkClick,\n}: AnimatedMermaidDiagramProps) {\n  const rawId = useId();\n  const diagramId = `mermaid-anim-${rawId.replace(/[:]/g, '')}`;\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const [svg, setSvg] = useState('');\n  const [error, setError] = useState<string | null>(null);\n  const [currentIndex, setCurrentIndex] = useState(-1);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [awaitingDecision, setAwaitingDecision] = useState(false);\n\n  // Render Mermaid diagram\n  useEffect(() => {\n    let isActive = true;\n\n    const renderDiagram = async () => {\n      try {\n        const mermaid = await ensureMermaidInitialized();\n        if (!isActive) return;\n        const { svg: renderedSvg } = await mermaid.render(diagramId, code);\n        if (!isActive) return;\n        setSvg(renderedSvg);\n        setError(null);\n      } catch (err) {\n        if (!isActive) return;\n        setSvg('');\n        setError(err instanceof Error ? err.message : 'Unable to render diagram');\n      }\n    };\n\n    renderDiagram();\n\n    return () => {\n      isActive = false;\n    };\n  }, [code, diagramId]);\n\n  // Apply highlight styles to SVG nodes and scroll active node into view\n  useEffect(() => {\n    if (!containerRef.current || !svg || nodes.length === 0) return;\n\n    const svgElement = containerRef.current.querySelector('svg');\n    if (!svgElement) return;\n\n    let activeNodeElement: Element | null = null;\n\n    // Reset all nodes\n    nodes.forEach((node, nodeIndex) => {\n      // Mermaid generates IDs like flowchart-A-0\n      const nodeGroup = svgElement.querySelector(`[id*=\"flowchart-${node.id}-\"]`);\n      if (nodeGroup) {\n        nodeGroup.classList.remove('node-active', 'node-past', 'node-future', 'node-decision', 'node-link');\n\n        if (currentIndex === -1) {\n          nodeGroup.classList.add('node-future');\n        } else if (nodeIndex === currentIndex) {\n          nodeGroup.classList.add('node-active');\n          activeNodeElement = nodeGroup;\n          if (node.type === 'decision') {\n            nodeGroup.classList.add('node-decision');\n          } else if (node.type === 'link') {\n            nodeGroup.classList.add('node-link');\n          }\n        } else if (nodeIndex < currentIndex) {\n          nodeGroup.classList.add('node-past');\n        } else {\n          nodeGroup.classList.add('node-future');\n        }\n      }\n    });\n\n    // Scroll active node to center of view\n    if (activeNodeElement && currentIndex >= 0) {\n      (activeNodeElement as HTMLElement).scrollIntoView({\n        behavior: 'smooth',\n        block: 'center',\n        inline: 'center',\n      });\n    }\n  }, [svg, nodes, currentIndex]);\n\n  // Animation timer\n  useEffect(() => {\n    if (!isPlaying || awaitingDecision || nodes.length === 0) return;\n\n    const currentNode = currentIndex >= 0 ? nodes[currentIndex] : null;\n    const isDecision = currentNode?.type === 'decision';\n\n    // Terminal nodes end the walkthrough immediately\n    if (currentNode?.terminal) {\n      setIsPlaying(false);\n      onComplete?.();\n      return;\n    }\n\n    // Use longer pause for decision nodes (10s slow pulse effect)\n    const interval = isDecision ? 10000 : speed;\n\n    const timer = setInterval(() => {\n      setCurrentIndex((prev) => {\n        const prevNode = prev >= 0 ? nodes[prev] : null;\n        const nextIndex = prevNode?.continueAt ?? prev + 1;\n\n        if (nextIndex >= nodes.length) {\n          setIsPlaying(false);\n          onComplete?.();\n          return prev;\n        }\n\n        // Check if next node is a decision or link - pause for user interaction\n        const nextNode = nodes[nextIndex];\n        if (nextNode?.type === 'decision' || nextNode?.type === 'link') {\n          setAwaitingDecision(true);\n          setIsPlaying(false);\n        }\n\n        return nextIndex;\n      });\n    }, interval);\n\n    return () => clearInterval(timer);\n  }, [isPlaying, awaitingDecision, nodes, speed, currentIndex, onComplete]);\n\n  const start = useCallback(() => {\n    const atTerminal = currentIndex >= 0 && nodes[currentIndex]?.terminal;\n    if (currentIndex === -1 || currentIndex >= nodes.length - 1 || atTerminal) {\n      setCurrentIndex(0);\n    }\n    setIsPlaying(true);\n    setAwaitingDecision(false);\n  }, [currentIndex, nodes]);\n\n  const pause = useCallback(() => {\n    setIsPlaying(false);\n  }, []);\n\n  const reset = useCallback(() => {\n    setCurrentIndex(-1);\n    setIsPlaying(false);\n    setAwaitingDecision(false);\n  }, []);\n\n  const skipToNext = useCallback(() => {\n    const currentNode = currentIndex >= 0 ? nodes[currentIndex] : null;\n    const targetIndex = currentNode?.continueAt ?? currentIndex + 1;\n    if (targetIndex < nodes.length) {\n      const targetNode = nodes[targetIndex];\n      setCurrentIndex(targetIndex);\n      // Check if target is a decision/link node - show its buttons\n      if (targetNode?.type === 'link' || targetNode?.type === 'decision') {\n        setAwaitingDecision(true);\n        setIsPlaying(false);\n      } else {\n        setAwaitingDecision(false);\n      }\n    }\n  }, [currentIndex, nodes]);\n\n  const goBack = useCallback(() => {\n    if (currentIndex > 0) {\n      const targetIndex = currentIndex - 1;\n      const targetNode = nodes[targetIndex];\n      setCurrentIndex(targetIndex);\n      setIsPlaying(false);\n      // Check if target is a decision/link node - show its buttons\n      if (targetNode?.type === 'link' || targetNode?.type === 'decision') {\n        setAwaitingDecision(true);\n      } else {\n        setAwaitingDecision(false);\n      }\n    }\n  }, [currentIndex, nodes]);\n\n  const continueFromDecision = useCallback((targetIndex: number) => {\n    setCurrentIndex(targetIndex);\n    // Check if target is a link/decision node - don't auto-play, show its buttons\n    const targetNode = nodes[targetIndex];\n    if (targetNode?.type === 'link' || targetNode?.type === 'decision') {\n      setAwaitingDecision(true);\n      setIsPlaying(false);\n    } else {\n      setAwaitingDecision(false);\n      setIsPlaying(true);\n    }\n  }, [nodes]);\n\n  if (error) {\n    return (\n      <div className=\"rounded-md border border-dashed p-4 text-sm text-muted-foreground\">\n        {error}\n      </div>\n    );\n  }\n\n  if (!svg) {\n    return (\n      <div className=\"rounded-md border border-dashed p-4 text-sm text-muted-foreground\">\n        Rendering diagram...\n      </div>\n    );\n  }\n\n  const progress = currentIndex === -1 ? 0 : ((currentIndex + 1) / nodes.length) * 100;\n  const currentNode = currentIndex >= 0 ? nodes[currentIndex] : null;\n  const isComplete = (currentIndex >= nodes.length - 1 || currentNode?.terminal) && !isPlaying;\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Side-by-side layout: Diagram + Context panel */}\n      <div className=\"grid lg:grid-cols-5 gap-4\">\n        {/* Diagram with animation styles */}\n        <div\n          ref={containerRef}\n          className={cn(\n            'lg:col-span-3 overflow-x-auto animated-mermaid [&_svg_*]:animate-none! rounded-lg bg-muted/30 p-4',\n            currentIndex >= 0 && 'animation-active'\n          )}\n        >\n        <style>{`\n          /* Override global * transition */\n          .animated-mermaid svg,\n          .animated-mermaid svg * {\n            transition: none !important;\n          }\n\n          .animated-mermaid.animation-active .node-future {\n            opacity: 0.25;\n          }\n\n          .animated-mermaid.animation-active .node-past {\n            opacity: 0.6;\n          }\n\n          .animated-mermaid.animation-active .node-active {\n            opacity: 1;\n          }\n\n          .animated-mermaid.animation-active .node-active rect,\n          .animated-mermaid.animation-active .node-active polygon,\n          .animated-mermaid.animation-active .node-active circle {\n            stroke: hsl(var(--primary));\n            stroke-width: 2px;\n          }\n\n          /* Decision nodes get amber stroke */\n          .animated-mermaid.animation-active .node-decision polygon {\n            stroke: hsl(45 93% 47%);\n          }\n\n          /* Link nodes get blue stroke */\n          .animated-mermaid.animation-active .node-link rect,\n          .animated-mermaid.animation-active .node-link polygon {\n            stroke: hsl(217 91% 60%);\n          }\n        `}</style>\n          <div\n            aria-label=\"Animated Mermaid diagram\"\n            dangerouslySetInnerHTML={{ __html: svg }}\n          />\n        </div>\n\n        {/* Context panel - alongside diagram, sticky and centered on scroll */}\n        <div className=\"lg:col-span-2 bg-card rounded-lg border p-5 flex flex-col justify-center min-h-[200px] lg:sticky lg:top-[calc(50vh-100px)] lg:self-start\">\n          {currentNode ? (\n            <div className=\"space-y-4\">\n              <div>\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <span className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\">\n                    Step {currentIndex + 1} of {nodes.length}\n                  </span>\n                  {currentNode.type === 'decision' && (\n                    <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-amber-500/20 text-amber-600 dark:text-amber-400\">\n                      Decision\n                    </span>\n                  )}\n                  {currentNode.type === 'link' && (\n                    <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-blue-500/20 text-blue-600 dark:text-blue-400\">\n                      Link\n                    </span>\n                  )}\n                </div>\n                <h3 className=\"text-lg font-semibold\">{currentNode.label}</h3>\n              </div>\n\n              <p className=\"text-sm text-muted-foreground\">{currentNode.description}</p>\n\n              {/* Progress bar */}\n              <div className=\"h-1.5 bg-muted rounded-full\">\n                <div\n                  className=\"h-full bg-primary rounded-full transition-all duration-300\"\n                  style={{ width: `${progress}%` }}\n                />\n              </div>\n\n              {/* Decision buttons */}\n              {awaitingDecision && currentNode.branches && (\n                <div className=\"flex gap-2\">\n                  <Button variant=\"outline\" size=\"sm\" onClick={goBack} disabled={currentIndex <= 0}>\n                    <SkipBack className=\"h-4 w-4\" />\n                  </Button>\n                  <Button onClick={() => continueFromDecision(currentNode.branches![0][1])} size=\"sm\" variant=\"outline\" className=\"flex-1\">\n                    {currentNode.branches[0][0]}\n                  </Button>\n                  <Button onClick={() => continueFromDecision(currentNode.branches![1][1])} size=\"sm\" variant=\"outline\" className=\"flex-1\">\n                    {currentNode.branches[1][0]}\n                  </Button>\n                </div>\n              )}\n\n              {/* Link buttons - always show when at a link node */}\n              {currentNode.type === 'link' && currentNode.linkTo && (\n                <div className=\"flex gap-2\">\n                  <Button variant=\"outline\" size=\"sm\" onClick={goBack} disabled={currentIndex <= 0}>\n                    <SkipBack className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    onClick={() => onLinkClick?.(currentNode.linkTo!)}\n                    size=\"sm\"\n                    variant=\"outline\"\n                    className=\"gap-2 flex-1\"\n                  >\n                    <ExternalLink className=\"h-4 w-4\" />\n                    View Details\n                  </Button>\n                  {currentIndex < nodes.length - 1 ? (\n                    <Button\n                      onClick={() => {\n                        setAwaitingDecision(false);\n                        setIsPlaying(true);\n                      }}\n                      size=\"sm\"\n                      variant=\"outline\"\n                      className=\"flex-1\"\n                    >\n                      Continue\n                    </Button>\n                  ) : (\n                    <Button\n                      onClick={reset}\n                      size=\"sm\"\n                      variant=\"outline\"\n                    >\n                      <RotateCcw className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n              )}\n\n              {/* Playback controls - hide when at link node (link has its own buttons) */}\n              {!awaitingDecision && currentNode.type !== 'link' && (\n                <div className=\"flex items-center gap-2 pt-2\">\n                  <Button variant=\"outline\" size=\"sm\" onClick={goBack} disabled={currentIndex <= 0}>\n                    <SkipBack className=\"h-4 w-4\" />\n                  </Button>\n                  {!isPlaying ? (\n                    <Button variant=\"outline\" size=\"sm\" onClick={start} className=\"gap-2 flex-1\">\n                      <Play className=\"h-4 w-4\" />\n                      {isComplete ? 'Replay' : 'Resume'}\n                    </Button>\n                  ) : (\n                    <Button variant=\"outline\" size=\"sm\" onClick={pause} className=\"gap-2 flex-1\">\n                      <Pause className=\"h-4 w-4\" />\n                      Pause\n                    </Button>\n                  )}\n                  {/* Hide skip and reset on final node - only show back and replay */}\n                  {!isComplete && (\n                    <>\n                      <Button variant=\"outline\" size=\"sm\" onClick={skipToNext}>\n                        <SkipForward className=\"h-4 w-4\" />\n                      </Button>\n                      <Button variant=\"outline\" size=\"sm\" onClick={reset}>\n                        <RotateCcw className=\"h-4 w-4\" />\n                      </Button>\n                    </>\n                  )}\n                </div>\n              )}\n            </div>\n          ) : isComplete ? (\n            <div className=\"space-y-4 text-center\">\n              <div className=\"text-4xl\">✅</div>\n              <h3 className=\"text-lg font-semibold\">Walkthrough Complete</h3>\n              <p className=\"text-sm text-muted-foreground\">\n                You've completed this flowchart walkthrough.\n              </p>\n              <Button onClick={reset} variant=\"outline\" size=\"sm\" className=\"mt-2\">\n                <RotateCcw className=\"h-4 w-4 mr-2\" />\n                Start Over\n              </Button>\n            </div>\n          ) : (\n            <button\n              onClick={start}\n              className=\"space-y-4 text-center w-full cursor-pointer hover:opacity-80 transition-opacity\"\n            >\n              <div className=\"text-4xl\">▶️</div>\n              <h3 className=\"text-lg font-semibold\">Ready to Begin</h3>\n              <p className=\"text-sm text-muted-foreground\">\n                Click to walk through this flowchart step by step.\n              </p>\n            </button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"file":"AnimatedMermaidDiagram-BR0aHej1.js"}